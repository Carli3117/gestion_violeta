<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tipos de Tarea | Violeta Workspace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <style>
    :root {
      --violeta-main: #7C3AED;
      --violeta-dark: #512da8;
      --violeta-light: #ede9fe;
      --gris: #f7f7fb;
      --white: #fff;
      --shadow: #a091df3b;
    }
    body {
      margin: 0;
      background: var(--gris);
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      color: #2a2244;
      min-height: 100vh;
    }
    .container-main {
      max-width: 650px;
      margin: 2.8rem auto 0 auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 28px #b6a3f524;
      padding: 2rem 1.7rem 1.3rem 1.7rem;
      animation: fadeInMain .7s .13s backwards;
    }
    @keyframes fadeInMain { from{opacity:0;transform:translateY(18px);} to{opacity:1;transform:none;} }
    .header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 1.25rem; gap:1em;
    }
    .header h2 {
      font-size: 1.37rem; color: var(--violeta-main); font-weight: 800; letter-spacing:.01em; margin:0;
    }
    .btn-violeta {
      background: var(--violeta-main);
      color: #fff;
      border: none;
      padding: .62em 1.17em;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1em;
      cursor: pointer;
      box-shadow: 0 2px 12px var(--shadow);
      display: flex; align-items: center; gap: .4em;
      transition: background .16s, transform .14s;
    }
    .btn-violeta:hover { background: var(--violeta-dark); transform:scale(1.04);}
    table {
      width: 100%; border-collapse: collapse; background: #fafaff;
      border-radius: 11px; overflow: hidden; margin-top: .6rem;
      box-shadow: 0 1px 6px #c4b1e526;
      font-size: 0.97em;
    }
    th, td {
      padding: .77em 1em;
      text-align: left;
      border-bottom: 1px solid #ede9fe;
    }
    th { background: var(--violeta-light); color: var(--violeta-dark); font-weight:700;}
    tr:last-child td { border-bottom: none; }
    .icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.08em;
      padding: .29em .41em;
      margin: 0 .09em;
      border-radius: 6px;
      transition: background .13s, color .13s, transform .12s;
    }
    .icon-btn.edit:hover { background: #ede9fe; color: var(--violeta-main);}
    .icon-btn.delete:hover { background: #fde8ee; color: #f44336;}
    .modal-violeta {
      display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(60,28,120,0.13); z-index: 1000;
      align-items: center; justify-content: center;
      animation: fadeInModal .27s;
    }
    @keyframes fadeInModal { from{opacity:0;} to{opacity:1;} }
    .modal-violeta.show { display: flex; }
    .modal-content {
      background: #fff;
      padding: 1.5rem 1.5rem 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 6px 28px #a08ce833;
      min-width: 260px; max-width: 95vw;
      animation: modalPopIn .34s cubic-bezier(.8,2,.2,.9);
      position:relative;
    }
    @keyframes modalPopIn {
      from{opacity:.2;transform:scale(.91);}
      to{opacity:1;transform:none;}
    }
    .modal-content h3 { margin-top: 0; color:var(--violeta-main);}
    .modal-content input, .modal-content textarea {
      width: 100%; margin: .45em 0 1em 0; border: 1.3px solid #e0e0e7;
      border-radius: 6px; padding: .6em 0.1em; font-size: .99em; background: #f9f8fe;
      outline: none; transition: border .15s;
      resize: vertical;
    }
    .modal-content input:focus, .modal-content textarea:focus {
      border-color: var(--violeta-main);
    }
    .modal-actions {
      display: flex; justify-content: flex-end; gap: .7em; margin-top: .7em;
    }
    .modal-actions button {
      background: #e7e2f9; color: var(--violeta-dark);
      border: none; border-radius: 6px; padding: .41em 1em;
      font-weight: 600; font-size: .97em; cursor: pointer; transition: background .13s;
    }
    .modal-actions .btn-violeta { background: var(--violeta-main); color: #fff; }
    .modal-actions button:hover { background: #dad2f6;}
    @media (max-width: 600px) {
      .container-main {padding:.8rem;}
      th, td {padding:.53em .6em;}
      .header h2{font-size:1em;}
    }
  </style>
</head>
<body>
<div class="container-main">
  <div class="header">
    <h2><i class="bi bi-list-task"></i> Tipos de Tarea</h2>
    <button class="btn-violeta" onclick="abrirModalNuevo()">
      <i class="bi bi-plus-circle"></i> Nuevo
    </button>
  </div>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Descripción</th>
        <th style="text-align:center;">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for tipo in tipos %}
      <tr>
        <td>{{ tipo.idtipo_tarea }}</td>
        <td>{{ tipo.nombre_tipo }}</td>
        <td>{{ tipo.descripcion or '—' }}</td>
        <td style="text-align:center;">
          <button type="button"
            class="icon-btn edit"
            title="Editar"
            onclick="abrirModalEditar({{ tipo.idtipo_tarea }}, {{ tipo.nombre_tipo|tojson }}, {{ tipo.descripcion|default('', true)|tojson }})">
            <i class="bi bi-pencil"></i>
          </button>
          <form method="POST"
                action="{{ url_for('tipo_tarea.eliminar_tipo_tarea_view', idtipo_tarea=tipo.idtipo_tarea) }}"
                style="display:inline;">
            <button type="submit" class="icon-btn delete" title="Eliminar"
              onclick="return confirm('¿Eliminar este tipo de tarea?');">
              <i class="bi bi-trash"></i>
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- MODAL NUEVO -->
<div id="modalNuevo" class="modal-violeta">
  <div class="modal-content">
    <h3>Nuevo Tipo de Tarea</h3>
    <form method="post" action="{{ url_for('tipo_tarea.nuevo_tipo_tarea') }}">
      <input type="text" name="nombre_tipo" placeholder="Nombre del tipo" required maxlength="50">
      <textarea name="descripcion" rows="2" placeholder="Descripción (opcional)"></textarea>
      <div class="modal-actions">
        <button type="button" onclick="cerrarModalNuevo()">Cancelar</button>
        <button type="submit" class="btn-violeta">Crear</button>
      </div>
    </form>
  </div>
</div>

<!-- MODAL EDITAR -->
<div id="modalEditar" class="modal-violeta">
  <div class="modal-content">
    <h3>Editar Tipo de Tarea</h3>
    <form id="formEditar" method="post">
      <input type="hidden" id="edit_idtipo_tarea" name="idtipo_tarea">
      <input type="text" id="edit_nombre_tipo" name="nombre_tipo" placeholder="Nombre del tipo" required maxlength="50">
      <textarea id="edit_descripcion" name="descripcion" rows="2" placeholder="Descripción (opcional)"></textarea>
      <div class="modal-actions">
        <button type="button" onclick="cerrarModalEditar()">Cancelar</button>
        <button type="submit" class="btn-violeta">Guardar</button>
      </div>
    </form>
  </div>
</div>

<script>
  // Abrir/Cerrar modal nuevo
  function abrirModalNuevo() {
    document.getElementById('modalNuevo').classList.add('show');
    setTimeout(function(){
      document.querySelector('#modalNuevo input[name="nombre_tipo"]').focus();
    }, 90);
  }
  function cerrarModalNuevo() {
    document.getElementById('modalNuevo').classList.remove('show');
  }
  // Abrir/Cerrar modal editar y setear datos
  function abrirModalEditar(id, nombre, descripcion) {
    document.getElementById('edit_idtipo_tarea').value = id;
    document.getElementById('edit_nombre_tipo').value = nombre || '';
    document.getElementById('edit_descripcion').value = descripcion || '';
    document.getElementById('formEditar').action = '/tipos-tarea/editar/' + id;
    document.getElementById('modalEditar').classList.add('show');
    setTimeout(function(){
      document.getElementById('edit_nombre_tipo').focus();
    }, 90);
  }
  function cerrarModalEditar() {
    document.getElementById('modalEditar').classList.remove('show');
  }
  // Cerrar modal con click afuera
  document.addEventListener('mousedown', function(e) {
    var mNuevo = document.getElementById('modalNuevo');
    var mEditar = document.getElementById('modalEditar');
    if (mNuevo.classList.contains('show') && !e.target.closest('.modal-content')) cerrarModalNuevo();
    if (mEditar.classList.contains('show') && !e.target.closest('.modal-content')) cerrarModalEditar();
  });
  // Cerrar con ESC
  document.addEventListener('keydown', function(e){
    if(e.key==="Escape") { cerrarModalNuevo(); cerrarModalEditar(); }
  });
</script>
</body>
</html>
